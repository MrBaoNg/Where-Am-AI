<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Where Am I?</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="main-content">
      <h1>Where Am I?</h1>
      <div class="upload-container" id="drop-area">
        <form id="uploadForm">
          <div class="upload-instructions">
            <p>Drag & Drop your image here</p>
            <input type="file" id="fileElem" accept="image/*" hidden />
            <button type="button" id="fileSelect">Select Image</button>
            <p id="file-name"></p>
          </div>
          <img id="preview" src="" alt="Image preview" />
        </form>
      </div>
      <button type="button" id="removeImage" style="display: none">
        Remove Image
      </button>
      <button type="button" id="uploadImage" style="display: none" onclick="uploadImage()">
        Upload Image
      </button>
    </div>
    <script>
      const dropArea = document.getElementById("drop-area");
      const fileInput = document.getElementById("fileElem");
      const fileSelect = document.getElementById("fileSelect");
      const fileName = document.getElementById("file-name");
      const previewImg = document.getElementById("preview");
      const uploadInstructions = document.querySelector(".upload-instructions");
      const removeImageButton = document.getElementById("removeImage");
      const uploadImageButton = document.getElementById("uploadImage");

      fileSelect.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", () => {
        const file = fileInput.files[0];
        if (file) {
          fileName.textContent = `Selected: ${file.name}`;
          showPreview(file);
        }
      });

      dropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropArea.classList.add("highlight");
      });

      dropArea.addEventListener("dragleave", () => {
        dropArea.classList.remove("highlight");
      });

      dropArea.addEventListener("drop", (e) => {
        e.preventDefault();
        dropArea.classList.remove("highlight");

        const file = e.dataTransfer.files[0];
        if (file) {
          fileInput.files = e.dataTransfer.files;
          fileName.textContent = `Dropped: ${file.name}`;
          showPreview(file);
        }
      });
      removeImageButton.addEventListener("click", () => {
        // Reset the form.
        fileInput.value = "";
        fileName.textContent = "";
        previewImg.src = "";
        previewImg.style.display = "none";
        uploadInstructions.style.display = "flex";
        dropArea.classList.remove("filled");
        removeImageButton.style.display = "none";
        uploadImageButton.style.display = "none";
      });

      function showPreview(file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewImg.src = e.target.result;
          previewImg.style.display = "block";
          uploadInstructions.style.display = "none";
          dropArea.classList.add("filled");
          removeImageButton.style.display = "block";
          uploadImageButton.style.display = "block";
        };
        reader.readAsDataURL(file); 
        
        async function uploadImage() {
          const input = document.getElementById('fileElem');
          const file = input.files[0];
      
          const formData = new FormData();
          formData.append('image', file);
      
          const response = await fetch('https://where-am-ai-backend.onrender.com/upload', {
            method: 'POST',
            body: formData,
          });
      
          const result = await response.json();
          alert(result.message);
        }
      }
    </script>
  </body>
</html>
